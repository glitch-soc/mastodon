{"version":3,"sources":["webpack:///app/javascript/home/mastodon/live/app/javascript/flavours/glitch/features/directory/index.jsx"],"names":["messages","defineMessages","title","recentlyActive","newArrivals","local","federated","Directory","connect","state","accountIds","getIn","ImmutableList","isLoading","domain","_dec","_class","injectIntl","_class2","React","PureComponent","constructor","arguments","order","handlePin","columnId","dispatch","this","props","removeColumn","addColumn","getParams","params","handleMove","dir","moveColumn","handleHeaderClick","column","scrollTop","setRef","c","handleChangeOrder","e","changeColumnParams","target","value","setState","handleChangeLocal","handleLoadMore","expandDirectory","componentDidMount","fetchDirectory","componentDidUpdate","prevProps","prevState","paramsOld","paramsNew","render","intl","multiColumn","pinned","scrollableArea","_jsx","className","role","RadioButton","name","label","formatMessage","checked","onChange","LoadingIndicator","map","accountId","AccountCard","id","LoadMore","onClick","visible","createElement","Column","bindToDocument","ref","ColumnHeader","icon","onPin","onMove","ScrollContainer","scrollKey","Helmet","content","contextTypes","router","PropTypes","object"],"mappings":"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","file":"js/features/glitch/async/directory-44ef148926fd7e3abef5.chunk.js","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport PropTypes from 'prop-types';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport Column from 'flavours/glitch/components/column';\nimport ColumnHeader from 'flavours/glitch/components/column_header';\nimport { addColumn, removeColumn, moveColumn, changeColumnParams } from 'flavours/glitch/actions/columns';\nimport { fetchDirectory, expandDirectory } from 'flavours/glitch/actions/directory';\nimport { List as ImmutableList } from 'immutable';\nimport AccountCard from './components/account_card';\nimport RadioButton from 'flavours/glitch/components/radio_button';\nimport LoadMore from 'flavours/glitch/components/load_more';\nimport ScrollContainer from 'flavours/glitch/containers/scroll_container';\nimport LoadingIndicator from 'flavours/glitch/components/loading_indicator';\nimport { Helmet } from 'react-helmet';\n\nconst messages = defineMessages({\n  title: { id: 'column.directory', defaultMessage: 'Browse profiles' },\n  recentlyActive: { id: 'directory.recently_active', defaultMessage: 'Recently active' },\n  newArrivals: { id: 'directory.new_arrivals', defaultMessage: 'New arrivals' },\n  local: { id: 'directory.local', defaultMessage: 'From {domain} only' },\n  federated: { id: 'directory.federated', defaultMessage: 'From known fediverse' },\n});\n\nconst mapStateToProps = state => ({\n  accountIds: state.getIn(['user_lists', 'directory', 'items'], ImmutableList()),\n  isLoading: state.getIn(['user_lists', 'directory', 'isLoading'], true),\n  domain: state.getIn(['meta', 'domain']),\n});\n\nexport default @connect(mapStateToProps)\n@injectIntl\nclass Directory extends React.PureComponent {\n\n  static contextTypes = {\n    router: PropTypes.object,\n  };\n\n  static propTypes = {\n    isLoading: PropTypes.bool,\n    accountIds: ImmutablePropTypes.list.isRequired,\n    dispatch: PropTypes.func.isRequired,\n    columnId: PropTypes.string,\n    intl: PropTypes.object.isRequired,\n    multiColumn: PropTypes.bool,\n    domain: PropTypes.string.isRequired,\n    params: PropTypes.shape({\n      order: PropTypes.string,\n      local: PropTypes.bool,\n    }),\n  };\n\n  state = {\n    order: null,\n    local: null,\n  };\n\n  handlePin = () => {\n    const { columnId, dispatch } = this.props;\n\n    if (columnId) {\n      dispatch(removeColumn(columnId));\n    } else {\n      dispatch(addColumn('DIRECTORY', this.getParams(this.props, this.state)));\n    }\n  };\n\n  getParams = (props, state) => ({\n    order: state.order === null ? (props.params.order || 'active') : state.order,\n    local: state.local === null ? (props.params.local || false) : state.local,\n  });\n\n  handleMove = dir => {\n    const { columnId, dispatch } = this.props;\n    dispatch(moveColumn(columnId, dir));\n  };\n\n  handleHeaderClick = () => {\n    this.column.scrollTop();\n  };\n\n  componentDidMount () {\n    const { dispatch } = this.props;\n    dispatch(fetchDirectory(this.getParams(this.props, this.state)));\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    const { dispatch } = this.props;\n    const paramsOld = this.getParams(prevProps, prevState);\n    const paramsNew = this.getParams(this.props, this.state);\n\n    if (paramsOld.order !== paramsNew.order || paramsOld.local !== paramsNew.local) {\n      dispatch(fetchDirectory(paramsNew));\n    }\n  }\n\n  setRef = c => {\n    this.column = c;\n  };\n\n  handleChangeOrder = e => {\n    const { dispatch, columnId } = this.props;\n\n    if (columnId) {\n      dispatch(changeColumnParams(columnId, ['order'], e.target.value));\n    } else {\n      this.setState({ order: e.target.value });\n    }\n  };\n\n  handleChangeLocal = e => {\n    const { dispatch, columnId } = this.props;\n\n    if (columnId) {\n      dispatch(changeColumnParams(columnId, ['local'], e.target.value === '1'));\n    } else {\n      this.setState({ local: e.target.value === '1' });\n    }\n  };\n\n  handleLoadMore = () => {\n    const { dispatch } = this.props;\n    dispatch(expandDirectory(this.getParams(this.props, this.state)));\n  };\n\n  render () {\n    const { isLoading, accountIds, intl, columnId, multiColumn, domain } = this.props;\n    const { order, local }  = this.getParams(this.props, this.state);\n    const pinned = !!columnId;\n\n    const scrollableArea = (\n      <div className='scrollable'>\n        <div className='filter-form'>\n          <div className='filter-form__column' role='group'>\n            <RadioButton name='order' value='active' label={intl.formatMessage(messages.recentlyActive)} checked={order === 'active'} onChange={this.handleChangeOrder} />\n            <RadioButton name='order' value='new' label={intl.formatMessage(messages.newArrivals)} checked={order === 'new'} onChange={this.handleChangeOrder} />\n          </div>\n\n          <div className='filter-form__column' role='group'>\n            <RadioButton name='local' value='1' label={intl.formatMessage(messages.local, { domain })} checked={local} onChange={this.handleChangeLocal} />\n            <RadioButton name='local' value='0' label={intl.formatMessage(messages.federated)} checked={!local} onChange={this.handleChangeLocal} />\n          </div>\n        </div>\n\n        <div className='directory__list'>\n          {isLoading ? <LoadingIndicator /> : accountIds.map(accountId => (\n            <AccountCard id={accountId} key={accountId} />\n          ))}\n        </div>\n\n        <LoadMore onClick={this.handleLoadMore} visible={!isLoading} />\n      </div>\n    );\n\n    return (\n      <Column bindToDocument={!multiColumn} ref={this.setRef} label={intl.formatMessage(messages.title)}>\n        <ColumnHeader\n          icon='address-book-o'\n          title={intl.formatMessage(messages.title)}\n          onPin={this.handlePin}\n          onMove={this.handleMove}\n          onClick={this.handleHeaderClick}\n          pinned={pinned}\n          multiColumn={multiColumn}\n        />\n\n        {multiColumn && !pinned ? <ScrollContainer scrollKey='directory'>{scrollableArea}</ScrollContainer> : scrollableArea}\n\n        <Helmet>\n          <title>{intl.formatMessage(messages.title)}</title>\n          <meta name='robots' content='noindex' />\n        </Helmet>\n      </Column>\n    );\n  }\n\n}\n"],"sourceRoot":""}