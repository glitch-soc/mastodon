{"version":3,"sources":["webpack:///app/javascript/home/mastodon/live/app/javascript/flavours/glitch/features/filters/select_filter.jsx","webpack:///app/javascript/home/mastodon/live/app/javascript/flavours/glitch/features/filters/added_to_filter.jsx","webpack:///app/javascript/home/mastodon/live/app/javascript/flavours/glitch/features/ui/components/filter_modal.jsx"],"names":["messages","defineMessages","search","clear","SelectFilter","connect","mapStateToProps","state","_ref","contextType","filters","Array","from","get","values","map","filter","_filter$get","keyword","join","Date","includes","toServerSideType","_dec","_class","injectIntl","React","PureComponent","constructor","arguments","searchValue","renderItem","warning","_jsx","className","FormattedMessage","id","defaultMessage","role","tabIndex","onClick","this","handleItemClick","onKeyDown","handleKeyDown","handleSearchChange","_ref2","target","setState","value","setListRef","c","listNode","e","index","childNodes","findIndex","node","currentTarget","element","key","click","firstChild","lastChild","shiftKey","focus","preventDefault","stopPropagation","handleSearchKeyDown","handleClear","getAttribute","props","onSelectFilter","handleNewFilterClick","onNewFilter","fuzzysort","go","keys","limit","threshold","result","obj","renderCreateNew","name","Icon","fixedWidth","render","intl","isSearching","results","Fragment","type","onChange","placeholder","formatMessage","autoFocus","disabled","deleteIcon","loupeIcon","createElement","ref","AddedToFilter","filterId","getIn","handleCloseClick","onClose","expiredMessage","contextMismatchMessage","settings_link","href","title","Button","close","FilterModal","undefined","_class2","ImmutablePureComponent","step","isSubmitting","isSubmitted","handleNewFilterSuccess","handleSelectFilter","handleSuccess","dispatch","statusId","fetchStatus","handleFail","handleNextStep","createFilterStatus","filter_id","status_id","handleNewFilter","createFilter","context","action","componentDidMount","fetchFilters","stepComponent","IconButton","icon","size","propTypes","PropTypes","string","isRequired","func","object"],"mappings":"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","file":"js/flavours/glitch/async/filter_modal-1285ff69345d1bf1b734.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { defineMessages, injectIntl, FormattedMessage } from 'react-intl';\nimport { toServerSideType } from 'flavours/glitch/utils/filters';\nimport { loupeIcon, deleteIcon } from 'flavours/glitch/utils/icons';\nimport Icon from 'flavours/glitch/components/icon';\nimport fuzzysort from 'fuzzysort';\n\nconst messages = defineMessages({\n  search: { id: 'filter_modal.select_filter.search', defaultMessage: 'Search or create' },\n  clear: { id: 'emoji_button.clear', defaultMessage: 'Clear' },\n});\n\nconst mapStateToProps = (state, { contextType }) => ({\n  filters: Array.from(state.get('filters').values()).map((filter) => [\n    filter.get('id'),\n    filter.get('title'),\n    filter.get('keywords')?.map((keyword) => keyword.get('keyword')).join('\\n'),\n    filter.get('expires_at') && filter.get('expires_at') < new Date(),\n    contextType && !filter.get('context').includes(toServerSideType(contextType)),\n  ]),\n});\n\nexport default @connect(mapStateToProps)\n@injectIntl\nclass SelectFilter extends React.PureComponent {\n\n  static propTypes = {\n    onSelectFilter: PropTypes.func.isRequired,\n    onNewFilter: PropTypes.func.isRequired,\n    filters: PropTypes.arrayOf(PropTypes.arrayOf(PropTypes.object)),\n    intl: PropTypes.object.isRequired,\n  };\n\n  state = {\n    searchValue: '',\n  };\n\n  search () {\n    const { filters } = this.props;\n    const { searchValue } = this.state;\n\n    if (searchValue === '') {\n      return filters;\n    }\n\n    return fuzzysort.go(searchValue, filters, {\n      keys: ['1', '2'],\n      limit: 5,\n      threshold: -10000,\n    }).map(result => result.obj);\n  }\n\n  renderItem = filter => {\n    let warning = null;\n    if (filter[3] || filter[4]) {\n      warning = (\n        <span className='language-dropdown__dropdown__results__item__common-name'>\n          (\n          {filter[3] && <FormattedMessage id='filter_modal.select_filter.expired' defaultMessage='expired' />}\n          {filter[3] && filter[4] && ', '}\n          {filter[4] && <FormattedMessage id='filter_modal.select_filter.context_mismatch' defaultMessage='does not apply to this context' />}\n          )\n        </span>\n      );\n    }\n\n    return (\n      <div key={filter[0]} role='button' tabIndex='0' data-index={filter[0]} className='language-dropdown__dropdown__results__item' onClick={this.handleItemClick} onKeyDown={this.handleKeyDown}>\n        <span className='language-dropdown__dropdown__results__item__native-name'>{filter[1]}</span> {warning}\n      </div>\n    );\n  };\n\n  renderCreateNew (name) {\n    return (\n      <div key='add-new-filter' role='button' tabIndex='0' className='language-dropdown__dropdown__results__item' onClick={this.handleNewFilterClick} onKeyDown={this.handleKeyDown}>\n        <Icon id='plus' fixedWidth /> <FormattedMessage id='filter_modal.select_filter.prompt_new' defaultMessage='New category: {name}' values={{ name }} />\n      </div>\n    );\n  }\n\n  handleSearchChange = ({ target }) => {\n    this.setState({ searchValue: target.value });\n  };\n\n  setListRef = c => {\n    this.listNode = c;\n  };\n\n  handleKeyDown = e => {\n    const index = Array.from(this.listNode.childNodes).findIndex(node => node === e.currentTarget);\n\n    let element = null;\n\n    switch(e.key) {\n    case ' ':\n    case 'Enter':\n      e.currentTarget.click();\n      break;\n    case 'ArrowDown':\n      element = this.listNode.childNodes[index + 1] || this.listNode.firstChild;\n      break;\n    case 'ArrowUp':\n      element = this.listNode.childNodes[index - 1] || this.listNode.lastChild;\n      break;\n    case 'Tab':\n      if (e.shiftKey) {\n        element = this.listNode.childNodes[index - 1] || this.listNode.lastChild;\n      } else {\n        element = this.listNode.childNodes[index + 1] || this.listNode.firstChild;\n      }\n      break;\n    case 'Home':\n      element = this.listNode.firstChild;\n      break;\n    case 'End':\n      element = this.listNode.lastChild;\n      break;\n    }\n\n    if (element) {\n      element.focus();\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  };\n\n  handleSearchKeyDown = e => {\n    let element = null;\n\n    switch(e.key) {\n    case 'Tab':\n    case 'ArrowDown':\n      element = this.listNode.firstChild;\n\n      if (element) {\n        element.focus();\n        e.preventDefault();\n        e.stopPropagation();\n      }\n\n      break;\n    }\n  };\n\n  handleClear = () => {\n    this.setState({ searchValue: '' });\n  };\n\n  handleItemClick = e => {\n    const value = e.currentTarget.getAttribute('data-index');\n\n    e.preventDefault();\n\n    this.props.onSelectFilter(value);\n  };\n\n  handleNewFilterClick = e => {\n    e.preventDefault();\n\n    this.props.onNewFilter(this.state.searchValue);\n  };\n\n  render () {\n    const { intl } = this.props;\n\n    const { searchValue } = this.state;\n    const isSearching = searchValue !== '';\n    const results = this.search();\n\n    return (\n      <React.Fragment>\n        <h3 className='report-dialog-modal__title'><FormattedMessage id='filter_modal.select_filter.title' defaultMessage='Filter this post' /></h3>\n        <p className='report-dialog-modal__lead'><FormattedMessage id='filter_modal.select_filter.subtitle' defaultMessage='Use an existing category or create a new one' /></p>\n\n        <div className='emoji-mart-search'>\n          <input type='search' value={searchValue} onChange={this.handleSearchChange} onKeyDown={this.handleSearchKeyDown} placeholder={intl.formatMessage(messages.search)} autoFocus />\n          <button className='emoji-mart-search-icon' disabled={!isSearching} aria-label={intl.formatMessage(messages.clear)} onClick={this.handleClear}>{!isSearching ? loupeIcon : deleteIcon}</button>\n        </div>\n\n        <div className='language-dropdown__dropdown__results emoji-mart-scroll' role='listbox' ref={this.setListRef}>\n          {results.map(this.renderItem)}\n          {isSearching && this.renderCreateNew(searchValue) }\n        </div>\n\n      </React.Fragment>\n    );\n  }\n\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ImmutablePropTypes from 'react-immutable-proptypes';\nimport { FormattedMessage } from 'react-intl';\nimport { toServerSideType } from 'flavours/glitch/utils/filters';\nimport Button from 'flavours/glitch/components/button';\nimport { connect } from 'react-redux';\n\nconst mapStateToProps = (state, { filterId }) => ({\n  filter: state.getIn(['filters', filterId]),\n});\n\nexport default @connect(mapStateToProps)\nclass AddedToFilter extends React.PureComponent {\n\n  static propTypes = {\n    onClose: PropTypes.func.isRequired,\n    contextType: PropTypes.string,\n    filter: ImmutablePropTypes.map.isRequired,\n    dispatch: PropTypes.func.isRequired,\n  };\n\n  handleCloseClick = () => {\n    const { onClose } = this.props;\n    onClose();\n  };\n\n  render () {\n    const { filter, contextType } = this.props;\n\n    let expiredMessage = null;\n    if (filter.get('expires_at') && filter.get('expires_at') < new Date()) {\n      expiredMessage = (\n        <React.Fragment>\n          <h4 className='report-dialog-modal__subtitle'><FormattedMessage id='filter_modal.added.expired_title' defaultMessage='Expired filter!' /></h4>\n          <p className='report-dialog-modal__lead'>\n            <FormattedMessage\n              id='filter_modal.added.expired_explanation'\n              defaultMessage='This filter category has expired, you will need to change the expiration date for it to apply.'\n            />\n          </p>\n        </React.Fragment>\n      );\n    }\n\n    let contextMismatchMessage = null;\n    if (contextType && !filter.get('context').includes(toServerSideType(contextType))) {\n      contextMismatchMessage = (\n        <React.Fragment>\n          <h4 className='report-dialog-modal__subtitle'><FormattedMessage id='filter_modal.added.context_mismatch_title' defaultMessage='Context mismatch!' /></h4>\n          <p className='report-dialog-modal__lead'>\n            <FormattedMessage\n              id='filter_modal.added.context_mismatch_explanation'\n              defaultMessage='This filter category does not apply to the context in which you have accessed this post. If you want the post to be filtered in this context too, you will have to edit the filter.'\n            />\n          </p>\n        </React.Fragment>\n      );\n    }\n\n    const settings_link = (\n      <a href={`/filters/${filter.get('id')}/edit`}>\n        <FormattedMessage\n          id='filter_modal.added.settings_link'\n          defaultMessage='settings page'\n        />\n      </a>\n    );\n\n    return (\n      <React.Fragment>\n        <h3 className='report-dialog-modal__title'><FormattedMessage id='filter_modal.added.title' defaultMessage='Filter added!' /></h3>\n        <p className='report-dialog-modal__lead'>\n          <FormattedMessage\n            id='filter_modal.added.short_explanation'\n            defaultMessage='This post has been added to the following filter category: {title}.'\n            values={{ title: filter.get('title') }}\n          />\n        </p>\n\n        {expiredMessage}\n        {contextMismatchMessage}\n\n        <h4 className='report-dialog-modal__subtitle'><FormattedMessage id='filter_modal.added.review_and_configure_title' defaultMessage='Filter settings' /></h4>\n        <p className='report-dialog-modal__lead'>\n          <FormattedMessage\n            id='filter_modal.added.review_and_configure'\n            defaultMessage='To review and further configure this filter category, go to the {settings_link}.'\n            values={{ settings_link }}\n          />\n        </p>\n\n        <div className='flex-spacer' />\n\n        <div className='report-dialog-modal__actions'>\n          <Button onClick={this.handleCloseClick}><FormattedMessage id='report.close' defaultMessage='Done' /></Button>\n        </div>\n      </React.Fragment>\n    );\n  }\n\n}\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport { fetchStatus } from 'flavours/glitch/actions/statuses';\nimport { fetchFilters, createFilter, createFilterStatus } from 'flavours/glitch/actions/filters';\nimport PropTypes from 'prop-types';\nimport { defineMessages, FormattedMessage, injectIntl } from 'react-intl';\nimport ImmutablePureComponent from 'react-immutable-pure-component';\nimport IconButton from 'flavours/glitch/components/icon_button';\nimport SelectFilter from 'flavours/glitch/features/filters/select_filter';\nimport AddedToFilter from 'flavours/glitch/features/filters/added_to_filter';\n\nconst messages = defineMessages({\n  close: { id: 'lightbox.close', defaultMessage: 'Close' },\n});\n\nexport default @connect(undefined)\n@injectIntl\nclass FilterModal extends ImmutablePureComponent {\n\n  static propTypes = {\n    statusId: PropTypes.string.isRequired,\n    contextType: PropTypes.string,\n    dispatch: PropTypes.func.isRequired,\n    intl: PropTypes.object.isRequired,\n  };\n\n  state = {\n    step: 'select',\n    filterId: null,\n    isSubmitting: false,\n    isSubmitted: false,\n  };\n\n  handleNewFilterSuccess = (result) => {\n    this.handleSelectFilter(result.id);\n  };\n\n  handleSuccess = () => {\n    const { dispatch, statusId } = this.props;\n    dispatch(fetchStatus(statusId, true));\n    this.setState({ isSubmitting: false, isSubmitted: true, step: 'submitted' });\n  };\n\n  handleFail = () => {\n    this.setState({ isSubmitting: false });\n  };\n\n  handleNextStep = step => {\n    this.setState({ step });\n  };\n\n  handleSelectFilter = (filterId) => {\n    const { dispatch, statusId } = this.props;\n\n    this.setState({ isSubmitting: true, filterId });\n\n    dispatch(createFilterStatus({\n      filter_id: filterId,\n      status_id: statusId,\n    }, this.handleSuccess, this.handleFail));\n  };\n\n  handleNewFilter = (title) => {\n    const { dispatch } = this.props;\n\n    this.setState({ isSubmitting: true });\n\n    dispatch(createFilter({\n      title,\n      context: ['home', 'notifications', 'public', 'thread', 'account'],\n      action: 'warn',\n    }, this.handleNewFilterSuccess, this.handleFail));\n  };\n\n  componentDidMount () {\n    const { dispatch } = this.props;\n\n    dispatch(fetchFilters());\n  }\n\n  render () {\n    const {\n      intl,\n      statusId,\n      contextType,\n      onClose,\n    } = this.props;\n\n    const {\n      step,\n      filterId,\n    } = this.state;\n\n    let stepComponent;\n\n    switch(step) {\n    case 'select':\n      stepComponent = (\n        <SelectFilter\n          contextType={contextType}\n          onSelectFilter={this.handleSelectFilter}\n          onNewFilter={this.handleNewFilter}\n        />\n      );\n      break;\n    case 'create':\n      stepComponent = null;\n      break;\n    case 'submitted':\n      stepComponent = (\n        <AddedToFilter\n          contextType={contextType}\n          filterId={filterId}\n          statusId={statusId}\n          onClose={onClose}\n        />\n      );\n    }\n\n    return (\n      <div className='modal-root__modal report-dialog-modal'>\n        <div className='report-modal__target'>\n          <IconButton className='report-modal__close' title={intl.formatMessage(messages.close)} icon='times' onClick={onClose} size={20} />\n          <FormattedMessage id='filter_modal.title.status' defaultMessage='Filter a post' />\n        </div>\n\n        <div className='report-dialog-modal__container'>\n          {stepComponent}\n        </div>\n      </div>\n    );\n  }\n\n}\n"],"sourceRoot":""}