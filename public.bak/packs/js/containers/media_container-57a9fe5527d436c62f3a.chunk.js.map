{"version":3,"sources":["webpack:///app/javascript/home/mastodon/live/app/javascript/mastodon/containers/media_container.jsx","webpack:///app/javascript/home/mastodon/live/app/javascript/flavours/glitch/containers/media_container.jsx"],"names":["localeData","messages","getLocale","addLocaleData","MEDIA_COMPONENTS","MediaGallery","Video","Card","Poll","Hashtag","Audio","MediaContainer","PureComponent","constructor","arguments","state","media","index","time","backgroundColor","options","handleOpenMedia","document","body","classList","add","documentElement","style","marginRight","getScrollbarWidth","this","setState","handleOpenVideo","components","props","JSON","parse","componentIndex","getAttribute","mediaList","fromJS","handleCloseMedia","remove","setBackgroundColor","color","render","_this$state$options","_this$state$options2","_this$state$options3","locale","_jsx","IntlProvider","Fragment","map","call","component","i","componentName","Component","card","poll","hashtag","Object","assign","onOpenVideo","onOpenMedia","ReactDOM","createPortal","React","createElement","_extends","key","ModalRoot","onClose","MediaModal","currentTime","startTime","autoPlay","volume","defaultVolume","onChangeBackgroundColor"],"mappings":"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","file":"js/containers/media_container-57a9fe5527d436c62f3a.chunk.js","sourcesContent":["import React, { PureComponent, Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { IntlProvider, addLocaleData } from 'react-intl';\nimport { fromJS } from 'immutable';\nimport { getLocale } from 'mastodon/locales';\nimport { getScrollbarWidth } from 'mastodon/utils/scrollbar';\nimport MediaGallery from 'mastodon/components/media_gallery';\nimport Poll from 'mastodon/components/poll';\nimport { ImmutableHashtag as Hashtag } from 'mastodon/components/hashtag';\nimport ModalRoot from 'mastodon/components/modal_root';\nimport MediaModal from 'mastodon/features/ui/components/media_modal';\nimport Video from 'mastodon/features/video';\nimport Card from 'mastodon/features/status/components/card';\nimport Audio from 'mastodon/features/audio';\n\nconst { localeData, messages } = getLocale();\naddLocaleData(localeData);\n\nconst MEDIA_COMPONENTS = { MediaGallery, Video, Card, Poll, Hashtag, Audio };\n\nexport default class MediaContainer extends PureComponent {\n\n  static propTypes = {\n    locale: PropTypes.string.isRequired,\n    components: PropTypes.object.isRequired,\n  };\n\n  state = {\n    media: null,\n    index: null,\n    time: null,\n    backgroundColor: null,\n    options: null,\n  };\n\n  handleOpenMedia = (media, index) => {\n    document.body.classList.add('with-modals--active');\n    document.documentElement.style.marginRight = `${getScrollbarWidth()}px`;\n\n    this.setState({ media, index });\n  };\n\n  handleOpenVideo = (options) => {\n    const { components } = this.props;\n    const { media } = JSON.parse(components[options.componentIndex].getAttribute('data-props'));\n    const mediaList = fromJS(media);\n\n    document.body.classList.add('with-modals--active');\n    document.documentElement.style.marginRight = `${getScrollbarWidth()}px`;\n\n    this.setState({ media: mediaList, options });\n  };\n\n  handleCloseMedia = () => {\n    document.body.classList.remove('with-modals--active');\n    document.documentElement.style.marginRight = 0;\n\n    this.setState({\n      media: null,\n      index: null,\n      time: null,\n      backgroundColor: null,\n      options: null,\n    });\n  };\n\n  setBackgroundColor = color => {\n    this.setState({ backgroundColor: color });\n  };\n\n  render () {\n    const { locale, components } = this.props;\n\n    return (\n      <IntlProvider locale={locale} messages={messages}>\n        <Fragment>\n          {[].map.call(components, (component, i) => {\n            const componentName = component.getAttribute('data-component');\n            const Component = MEDIA_COMPONENTS[componentName];\n            const { media, card, poll, hashtag, ...props } = JSON.parse(component.getAttribute('data-props'));\n\n            Object.assign(props, {\n              ...(media   ? { media:   fromJS(media)   } : {}),\n              ...(card    ? { card:    fromJS(card)    } : {}),\n              ...(poll    ? { poll:    fromJS(poll)    } : {}),\n              ...(hashtag ? { hashtag: fromJS(hashtag) } : {}),\n\n              ...(componentName === 'Video' ? {\n                componentIndex: i,\n                onOpenVideo: this.handleOpenVideo,\n              } : {\n                onOpenMedia: this.handleOpenMedia,\n              }),\n            });\n\n            return ReactDOM.createPortal(\n              <Component {...props} key={`media-${i}`} />,\n              component,\n            );\n          })}\n\n          <ModalRoot backgroundColor={this.state.backgroundColor} onClose={this.handleCloseMedia}>\n            {this.state.media && (\n              <MediaModal\n                media={this.state.media}\n                index={this.state.index || 0}\n                currentTime={this.state.options?.startTime}\n                autoPlay={this.state.options?.autoPlay}\n                volume={this.state.options?.defaultVolume}\n                onClose={this.handleCloseMedia}\n                onChangeBackgroundColor={this.setBackgroundColor}\n              />\n            )}\n          </ModalRoot>\n        </Fragment>\n      </IntlProvider>\n    );\n  }\n\n}\n","import React, { PureComponent, Fragment } from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { IntlProvider, addLocaleData } from 'react-intl';\nimport { fromJS } from 'immutable';\nimport { getLocale } from 'mastodon/locales';\nimport { getScrollbarWidth } from 'flavours/glitch/utils/scrollbar';\nimport MediaGallery from 'flavours/glitch/components/media_gallery';\nimport Poll from 'flavours/glitch/components/poll';\nimport { ImmutableHashtag as Hashtag } from 'flavours/glitch/components/hashtag';\nimport ModalRoot from 'flavours/glitch/components/modal_root';\nimport MediaModal from 'flavours/glitch/features/ui/components/media_modal';\nimport Video from 'flavours/glitch/features/video';\nimport Card from 'flavours/glitch/features/status/components/card';\nimport Audio from 'flavours/glitch/features/audio';\n\nconst { localeData, messages } = getLocale();\naddLocaleData(localeData);\n\nconst MEDIA_COMPONENTS = { MediaGallery, Video, Card, Poll, Hashtag, Audio };\n\nexport default class MediaContainer extends PureComponent {\n\n  static propTypes = {\n    locale: PropTypes.string.isRequired,\n    components: PropTypes.object.isRequired,\n  };\n\n  state = {\n    media: null,\n    index: null,\n    time: null,\n    backgroundColor: null,\n    options: null,\n  };\n\n  handleOpenMedia = (media, index) => {\n    document.body.classList.add('with-modals--active');\n    document.documentElement.style.marginRight = `${getScrollbarWidth()}px`;\n\n    this.setState({ media, index });\n  };\n\n  handleOpenVideo = (options) => {\n    const { components } = this.props;\n    const { media } = JSON.parse(components[options.componentIndex].getAttribute('data-props'));\n    const mediaList = fromJS(media);\n\n    document.body.classList.add('with-modals--active');\n    document.documentElement.style.marginRight = `${getScrollbarWidth()}px`;\n\n    this.setState({ media: mediaList, options });\n  };\n\n  handleCloseMedia = () => {\n    document.body.classList.remove('with-modals--active');\n    document.documentElement.style.marginRight = 0;\n\n    this.setState({\n      media: null,\n      index: null,\n      time: null,\n      backgroundColor: null,\n      options: null,\n    });\n  };\n\n  setBackgroundColor = color => {\n    this.setState({ backgroundColor: color });\n  };\n\n  render () {\n    const { locale, components } = this.props;\n\n    return (\n      <IntlProvider locale={locale} messages={messages}>\n        <Fragment>\n          {[].map.call(components, (component, i) => {\n            const componentName = component.getAttribute('data-component');\n            const Component = MEDIA_COMPONENTS[componentName];\n            const { media, card, poll, hashtag, ...props } = JSON.parse(component.getAttribute('data-props'));\n\n            Object.assign(props, {\n              ...(media   ? { media:   fromJS(media)   } : {}),\n              ...(card    ? { card:    fromJS(card)    } : {}),\n              ...(poll    ? { poll:    fromJS(poll)    } : {}),\n              ...(hashtag ? { hashtag: fromJS(hashtag) } : {}),\n\n              ...(componentName === 'Video' ? {\n                componentIndex: i,\n                onOpenVideo: this.handleOpenVideo,\n              } : {\n                onOpenMedia: this.handleOpenMedia,\n              }),\n            });\n\n            return ReactDOM.createPortal(\n              <Component {...props} key={`media-${i}`} />,\n              component,\n            );\n          })}\n\n          <ModalRoot backgroundColor={this.state.backgroundColor} onClose={this.handleCloseMedia}>\n            {this.state.media && (\n              <MediaModal\n                media={this.state.media}\n                index={this.state.index || 0}\n                currentTime={this.state.options?.startTime}\n                autoPlay={this.state.options?.autoPlay}\n                volume={this.state.options?.defaultVolume}\n                onClose={this.handleCloseMedia}\n                onChangeBackgroundColor={this.setBackgroundColor}\n              />\n            )}\n          </ModalRoot>\n        </Fragment>\n      </IntlProvider>\n    );\n  }\n\n}\n"],"sourceRoot":""}